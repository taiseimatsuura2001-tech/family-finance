# リリース前チェックリスト

このドキュメントは、本番環境へのリリース前に確認すべき項目をまとめたものです。

## ✅ コード品質

- [x] すべての単体テストが通過（75/75 tests passed）
- [x] すべての統合テストが通過
- [x] ビルドが成功（npm run build）
- [ ] E2Eテストが通過（手動実施推奨）
- [x] TypeScriptのコンパイルエラーなし
- [x] Lintエラーなし

## ✅ 機能テスト

### 権限制御機能

#### ADMIN（User1）でのテスト
- [ ] ログインできる
- [ ] ダッシュボードでユーザー選択セレクターが表示される
- [ ] User2のデータに切り替えられる
- [ ] User2のトランザクションが表示される
- [ ] 「閲覧モード」インジケーターが表示される
- [ ] 閲覧モード時、登録ボタンが非表示になる
- [ ] 閲覧モード時、設定リンクが非表示になる
- [ ] 自分のデータに戻れる

#### USER（User2）でのテスト
- [ ] ログインできる
- [ ] ダッシュボードでユーザー選択セレクターが表示されない
- [ ] 自分のデータのみ表示される
- [ ] 登録ボタンが表示される（閲覧モードではない）
- [ ] 設定リンクが表示される

### レスポンシブデザイン

#### モバイル（375px × 667px - iPhone SE）
- [ ] ナビゲーション：ハンバーガーメニューが表示される
- [ ] ナビゲーション：メニューが開閉できる
- [ ] ダッシュボード：カードが縦に並ぶ
- [ ] ダッシュボード：ヘッダーが崩れない
- [ ] 収入ページ：ヘッダーとボタンが適切に配置される
- [ ] 支出ページ：ヘッダーとボタンが適切に配置される
- [ ] カレンダー：日付セルが読める（min-h-[60px]）
- [ ] カレンダー：月間ナビゲーションが使える
- [ ] カレンダー：金額表示が読める
- [ ] 分析ページ：グラフが表示される

#### タブレット（768px × 1024px - iPad）
- [ ] ナビゲーション：通常メニューが表示される
- [ ] レイアウトが適切に調整される
- [ ] カレンダーのセルサイズが適切

#### デスクトップ（1920px × 1080px）
- [ ] すべての要素が適切に配置される
- [ ] 余白が適切

## ✅ セキュリティテスト

### 認証
- [ ] 未認証ユーザーは/loginにリダイレクトされる
- [ ] セッション有効期限が正しく動作する（30日）
- [ ] ログアウトが正しく動作する

### 権限チェック
- [ ] USER が他ユーザーのデータにアクセスしようとすると403エラー
  ```bash
  # テスト方法（ブラウザのDevToolsで実行）
  # USER2でログイン後、以下のAPIを実行
  fetch('/api/transactions?viewUserId=<user1-id>')
  # 期待結果: 403 Forbidden
  ```
- [ ] API直接呼び出しでも権限チェックが動作する
  - [ ] /api/transactions
  - [ ] /api/categories
  - [ ] /api/vendors
- [ ] 認証なしでAPIにアクセスすると401エラー

## ✅ データベース

- [x] Prismaスキーマが最新
- [x] マイグレーションが適用済み
- [x] シードデータが正しく動作する
  ```bash
  npm run db:seed
  ```
- [ ] User1がADMINロールに設定されている
- [ ] User2がUSERロールに設定されている
- [ ] 両ユーザーにカテゴリと支払い方法が作成されている

## ✅ パフォーマンス

- [ ] ページ読み込み時間が3秒以内
- [ ] トランザクション一覧の表示が高速
- [ ] 画像の最適化（該当する場合）
- [ ] バンドルサイズが適切

## ✅ ブラウザ互換性

- [ ] Chrome（最新版）で動作確認
- [ ] Safari（最新版）で動作確認
- [ ] Firefox（最新版）で動作確認
- [ ] Edge（最新版）で動作確認
- [ ] モバイルSafari（iOS）で動作確認
- [ ] モバイルChrome（Android）で動作確認

## ✅ デプロイメント

- [ ] 環境変数が正しく設定されている
  - [ ] DATABASE_URL
  - [ ] DIRECT_URL
  - [ ] NEXTAUTH_SECRET
  - [ ] NEXTAUTH_URL
  - [ ] USER1_EMAIL
  - [ ] USER2_EMAIL
  - [ ] EMAIL_SERVER_* (メール送信設定)
- [ ] 本番環境でビルドが成功する
- [ ] 本番環境でデータベースマイグレーションが実行される
- [ ] 本番環境でシードデータが実行される

## ✅ ドキュメント

- [ ] READMEが更新されている
- [ ] 権限管理の説明が追加されている
- [ ] レスポンシブ対応の説明が追加されている
- [ ] セットアップ手順が明確

## 🚀 リリース判断基準

### 必須項目（これらが満たされていない場合はリリース不可）
- ✅ すべての自動テストが通過
- ✅ ビルドが成功
- ⚠️ ADMIN/USER権限の手動テスト完了
- ⚠️ モバイル表示の手動確認完了
- ⚠️ セキュリティテスト（API権限チェック）完了

### 推奨項目（満たされていることが望ましい）
- E2Eテストの実装と実行
- 全ブラウザでの動作確認
- パフォーマンステスト

## 📝 リリース手順

1. このチェックリストのすべての項目を確認
2. 必須項目がすべて完了していることを確認
3. デプロイ前にバックアップを取得
4. ステージング環境でテスト（推奨）
5. 本番環境にデプロイ
6. デプロイ後の動作確認
7. ユーザーに変更内容を通知

## 🔍 現在の状態

### 完了済み
- ✅ 単体テスト・統合テスト（75件）
- ✅ ビルド成功
- ✅ TypeScriptコンパイル成功
- ✅ 権限制御機能実装
- ✅ レスポンシブデザイン実装
- ✅ シードデータ対応

### 未完了（リリース前に推奨）
- ⚠️ 手動での権限テスト
- ⚠️ モバイル実機での表示確認
- ⚠️ API権限の手動確認
- ⚠️ E2Eテストの実装（オプション）

---

**リリース責任者サイン**: ____________

**リリース日時**: ____________
