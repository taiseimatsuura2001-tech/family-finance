# 家計管理アプリケーション 要件定義書

## 1. プロジェクト概要

### 1.1 プロジェクト名
家計管理アプリケーション「FamilyFinance」

### 1.2 プロジェクトの背景と目的
家族（2名）の収支を効率的に管理し、家計の見える化を実現することで、計画的な資産形成と支出の最適化を支援する。

### 1.3 対象ユーザー
- 主利用者：申請者本人
- 副利用者：母親
- 計2名の限定利用

### 1.4 システムの位置づけ
プライベート利用に特化した、高セキュリティ家計管理システム

## 2. 機能要件

### 2.1 ユーザー管理機能

#### 2.1.1 認証機能
- **多要素認証（MFA）の実装**
  - Google OAuth 2.0による認証
  - Microsoft Entra ID（旧Azure AD）による認証
  - 認証プロバイダーの選択制
- **ユーザー登録制限**
  - ホワイトリスト方式による2名限定のアクセス制御
  - メールアドレスベースの事前登録制
- **セッション管理**
  - セッションタイムアウト（30分）
  - 同時ログイン制限（1デバイスのみ）
  - ログイン履歴の記録

#### 2.1.2 権限管理
- **ユーザーロール**
  - 管理者（全機能アクセス可能）
  - 一般ユーザー（自身のデータのみアクセス可能）
- **データアクセス制御**
  - ユーザー別のデータ分離
  - 共有データの閲覧権限設定

### 2.2 収支管理機能

#### 2.2.1 収入管理
- **収入の登録**
  - 日付、金額、カテゴリー、詳細、支払元の入力
  - マスタからのドロップダウン選択
  - 定期収入の自動登録機能
- **収入の編集・削除**
  - 過去データの修正機能
  - 削除時の確認ダイアログ
  - 変更履歴の保持
- **収入の検索**
  - 期間指定検索
  - カテゴリー別検索
  - キーワード検索
  - 金額範囲検索

#### 2.2.2 支出管理
- **支出の登録**
  - 日付、金額、カテゴリー、詳細、支払先、支払方法の入力
  - レシート画像のアップロード機能
  - 定期支出の自動登録機能
- **支出の編集・削除**
  - 過去データの修正機能
  - 削除時の確認ダイアログ
  - 変更履歴の保持
- **支出の検索**
  - 期間指定検索
  - カテゴリー別検索
  - キーワード検索
  - 金額範囲検索
  - 支払方法別検索

### 2.3 マスタ管理機能

#### 2.3.1 カテゴリーマスタ
- **収入カテゴリー**
  - 給与、賞与、副業収入、投資収益、その他
  - カスタムカテゴリーの追加・編集・削除
- **支出カテゴリー**
  - 食費、住居費、光熱費、通信費、交通費、医療費、教育費、娯楽費、その他
  - サブカテゴリーの設定（例：食費→外食、自炊）

#### 2.3.2 支払方法マスタ
- 現金、クレジットカード、デビットカード、電子マネー、銀行振込
- カード別の管理（複数カードの登録）

#### 2.3.3 店舗・企業マスタ
- よく利用する店舗の事前登録
- 定期支払先の登録

### 2.4 可視化・分析機能

#### 2.4.1 グラフ表示
- **円グラフ**
  - 収入内訳の円グラフ
  - 支出内訳の円グラフ
  - カテゴリー別の割合表示
- **棒グラフ**
  - 月別収支推移
  - 年間収支比較
- **折れ線グラフ**
  - 資産残高推移
  - カテゴリー別支出推移

#### 2.4.2 レポート機能
- **月次レポート**
  - 収支サマリー
  - 前月比較
  - 予算対実績
- **年次レポート**
  - 年間収支総括
  - カテゴリー別分析
  - 節約ポイントの提案

### 2.5 予算管理機能

#### 2.5.1 予算設定
- 月別予算の設定
- カテゴリー別予算の設定
- 年間予算の設定

#### 2.5.2 予算アラート
- 予算超過警告（80%、100%時点）
- プッシュ通知機能
- メール通知機能

### 2.6 データ管理機能

#### 2.6.1 バックアップ・リストア
- 自動バックアップ（日次）
- 手動バックアップ
- データ復元機能

#### 2.6.2 エクスポート機能
- CSV形式でのエクスポート
- PDF形式でのレポート出力
- Excel形式での帳票出力

#### 2.6.3 インポート機能
- CSVファイルからの一括登録
- 銀行明細のインポート（CSV形式）
- クレジットカード明細のインポート

### 2.7 追加便利機能

#### 2.7.1 家計簿AI分析
- 支出パターンの分析
- 節約提案機能
- 異常支出の検知

#### 2.7.2 共有機能
- 家族間でのデータ共有設定
- 共有範囲の細かい制御
- コメント機能

#### 2.7.3 目標設定機能
- 貯金目標の設定
- 目標達成度の可視化
- マイルストーン管理

## 3. 非機能要件

### 3.1 性能要件
- **レスポンスタイム**
  - 画面遷移：2秒以内
  - データ検索：3秒以内
  - グラフ描画：2秒以内
- **同時接続数**
  - 最大2ユーザーの同時接続

### 3.2 セキュリティ要件
- **認証・認可**
  - OAuth 2.0 / OpenID Connect準拠
  - JWTトークンによる認証
  - リフレッシュトークンの実装
- **通信の暗号化**
  - HTTPS通信の強制
  - TLS 1.3以上の使用
- **データ暗号化**
  - データベース暗号化（AES-256）
  - 機密情報のハッシュ化
- **監査ログ**
  - アクセスログの記録
  - 操作ログの記録
  - 不正アクセス検知

### 3.3 可用性要件
- **稼働率**
  - 月間稼働率99%以上
- **バックアップ**
  - 日次自動バックアップ
  - 3世代管理

### 3.4 保守性要件
- **ログ管理**
  - エラーログの自動収集
  - パフォーマンスログの記録
- **監視**
  - ヘルスチェック機能
  - リソース監視

### 3.5 ユーザビリティ要件
- **レスポンシブデザイン**
  - PC、タブレット、スマートフォン対応
- **アクセシビリティ**
  - WCAG 2.1 Level AA準拠
- **多言語対応**
  - 日本語対応（将来的に英語対応も検討）

## 4. システム制約

### 4.1 技術スタック
- **フロントエンド**
  - Next.js 14以上
  - React 18以上
  - TypeScript 5以上
  - Tailwind CSS
- **バックエンド**
  - Next.js API Routes
  - Prisma ORM
- **データベース**
  - Supabase（PostgreSQL）
- **認証**
  - NextAuth.js
- **ホスティング**
  - Vercel

### 4.2 開発制約
- モダンブラウザのみサポート（Chrome、Firefox、Safari、Edge の最新2バージョン）
- モバイルファーストの設計
- Progressive Web App（PWA）対応

### 4.3 運用制約
- Vercelの無料プランまたはProプランの制限内での運用
- Supabaseの無料プランまたはProプランの制限内での運用

## 5. 外部インターフェース

### 5.1 ユーザーインターフェース
- Webブラウザベースのインターフェース
- レスポンシブデザイン
- ダークモード対応

### 5.2 外部システム連携
- Google OAuth API
- Microsoft Entra ID API
- 将来的な銀行API連携の拡張性確保

## 6. 用語定義

| 用語 | 定義 |
|------|------|
| ユーザー | システムを利用する個人（2名限定） |
| カテゴリー | 収支を分類するための項目 |
| マスタ | 選択肢として事前に登録されたデータ |
| トランザクション | 個別の収入または支出の記録 |
| MFA | 多要素認証（Multi-Factor Authentication） |
| JWT | JSON Web Token |

## 7. 前提条件
- ユーザーは基本的なPC/スマートフォン操作ができる
- インターネット接続環境がある
- GoogleまたはMicrosoftのアカウントを保有している

## 8. リスクと対策

| リスク | 影響度 | 発生確率 | 対策 |
|--------|--------|----------|------|
| 不正アクセス | 高 | 低 | MFA実装、ホワイトリスト制御 |
| データ損失 | 高 | 低 | 自動バックアップ、3世代管理 |
| サービス停止 | 中 | 低 | Vercel/Supabaseの冗長性に依存 |
| 情報漏洩 | 高 | 低 | 暗号化、セキュアコーディング |

## 9. 成功基準
- 2名のユーザーが安全にシステムを利用できる
- 日々の収支入力が1分以内で完了する
- 月次の家計分析が自動的に可視化される
- 不正アクセスが完全に防止される

## 10. 今後の拡張予定
- 銀行口座との自動連携
- レシートOCR機能
- 家計簿データのAI分析高度化
- 投資管理機能の追加
- 資産管理機能の追加

---
作成日：2024年11月
作成者：システム設計チーム
バージョン：1.0